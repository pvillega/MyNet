<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:s="http://jboss.com/products/seam/taglib"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:rich="http://richfaces.org/rich"
    xmlns:a="http://richfaces.org/a4j"
    template="../layout/template.xhtml">

<ui:define name="body">

    <h:form id="linkForm">

        <rich:panel>
            <f:facet name="header">#{tagHome.managed ? 'Edit' : 'Add'} Link</f:facet>
            
            <s:decorate id="categoryField" template="../layout/edit.xhtml" rendered="#{identity.loggedIn and currentUser.id eq linkHome.instance.creator.id}">
                <ui:define name="label">Category</ui:define>
                <ui:define name="description">is used to classify the link</ui:define>
                <h:selectOneMenu value="#{linkHome.instance.category}" required="true">
					<s:selectItems value="#{categoryList}" var="category" label="#{category.name}" itemValue="#{category}" noSelectionLabel="Select a category"/>
					<s:convertEntity />
					<a:support event="onblur" reRender="categoryField" bypassUpdates="true" ajaxSingle="true"/>
				</h:selectOneMenu>                
            </s:decorate>
            
            <s:decorate id="anonCategoryField" template="../layout/edit.xhtml" rendered="#{not identity.loggedIn or currentUser.id ne linkHome.instance.creator.id}">
                <ui:define name="label">Category</ui:define>                
                <h:outputText value="#{linkHome.instance.category.name}" />                                
            </s:decorate>
            
            <s:decorate id="creatorField" template="../layout/edit.xhtml" rendered="#{linkHome.instance.creator ne null}">
                <ui:define name="label">Creator</ui:define>
                <ui:define name="description">is the user who saved this link</ui:define>
                <h:outputText value="#{linkHome.instance.creator.username}" />                
            </s:decorate>

            <s:decorate id="nameField" template="../layout/edit.xhtml" rendered="#{identity.loggedIn and currentUser.id eq linkHome.instance.creator.id}">
                <ui:define name="label">Name</ui:define>
                <ui:define name="description">is a short identifier for the link</ui:define>
                <h:inputText id="name" required="true"
                             value="#{linkHome.instance.name}">
                	<a:support event="onblur" reRender="nameField" bypassUpdates="true" ajaxSingle="true"/>
                </h:inputText>
            </s:decorate>

            <s:decorate id="anonNameField" template="../layout/edit.xhtml" rendered="#{not identity.loggedIn or currentUser.id ne linkHome.instance.creator.id}">
                <ui:define name="label">Name</ui:define>
                <h:outputText value="#{linkHome.instance.name}" />                
            </s:decorate>
            
            <s:decorate id="urlField" template="../layout/edit.xhtml" rendered="#{identity.loggedIn and currentUser.id eq linkHome.instance.creator.id}">
                <ui:define name="label">URL</ui:define>
                <ui:define name="description">is the URL you want to store</ui:define>
                <h:inputText id="url" required="true"
                             value="#{linkHome.instance.url}">
                	<a:support event="onblur" reRender="urlField" bypassUpdates="true" ajaxSingle="true"/>
                </h:inputText>             
            </s:decorate>
            
            <s:decorate id="anonUrlField" template="../layout/edit.xhtml" rendered="#{not identity.loggedIn or currentUser.id ne linkHome.instance.creator.id}">
                <ui:define name="label">URL</ui:define>
                <h:outputText value="#{linkHome.instance.url}" />                
            </s:decorate>
            
            <s:decorate id="descriptionField" template="../layout/edit.xhtml" rendered="#{identity.loggedIn and currentUser.id eq linkHome.instance.creator.id}">
                <ui:define name="label">Description</ui:define>
                <rich:editor id="descriptionEditor" required="false"                	
            		value="#{linkHome.instance.description}" >
            	</rich:editor>
            </s:decorate>
            
            <s:decorate id="anonDescriptionField" template="../layout/edit.xhtml" rendered="#{not identity.loggedIn or currentUser.id ne linkHome.instance.creator.id}">
                <ui:define name="label">Description</ui:define>
                <h:outputText value="#{linkHome.instance.description}" escape="false" />            	
            </s:decorate>                                              
            
            <s:decorate id="publicField" template="../layout/edit.xhtml" rendered="#{identity.loggedIn and currentUser.id eq linkHome.instance.creator.id}">
                <ui:define name="label">Private</ui:define>
                <ui:define name="description">Selected if you don't want to share your link</ui:define>
                <h:selectBooleanCheckbox value="#{linkHome.instance.hidden}" required="false" />                
            </s:decorate>
            
            <s:decorate id="tagsField" template="../layout/edit.xhtml" rendered="#{identity.loggedIn and currentUser.id eq linkHome.instance.creator.id}">
            	<ui:define name="label">Tags</ui:define>
            	<ui:define name="description">is a list of comma separated words that identify the link</ui:define>
                <h:inputText value="#{linkHome.instance.taglist}" />                							
            </s:decorate>
                      
            <s:decorate id="tagListField" template="../layout/edit.xhtml" rendered="#{identity.loggedIn and currentUser.id eq linkHome.instance.creator.id}">
                <ui:define name="label"> </ui:define>
                <ui:define name="description">are the current tags</ui:define>
				<b><h:outputText value="#{linkHome.instance.formattedTags()}" /></b>
            </s:decorate>
            
            <s:decorate id="anonTagListField" template="../layout/edit.xhtml" rendered="#{not identity.loggedIn or currentUser.id ne linkHome.instance.creator.id}">
                <ui:define name="label">Tags</ui:define>                
				<ui:repeat value="#{link.tags}" var="tag">
               		<s:link 
               			propagation="join"
               			view="/byTag.xhtml" 
               			value="#{tag.name} (#{tag.numLinks})" >
               			<f:param name="tag"
                              value="#{tag}"/>
                           <s:convertEntity/>          
                  	</s:link>	   
                  	#{'  '}               
          		</ui:repeat>           
            </s:decorate>
            
            <s:decorate id="pointsField" template="../layout/edit.xhtml">
            	<ui:define name="label">Valoration</ui:define>
            	<h:outputText value="#{linkHome.instance.valoration()}" />    
            	#{'  '}                      
                <h:commandButton action="#{linkListTools.vote(linkHome.instance,1)}" value="Like!" rendered="#{identity.loggedIn}" />
                <h:commandButton action="#{linkListTools.vote(linkHome.instance,-1)}" value="Hate!" rendered="#{identity.loggedIn}" />
            </s:decorate>            
            
            <div style="clear:both">
            	<h:outputText value="*" styleClass="required" rendered="#{identity.loggedIn and currentUser.id eq linkHome.instance.creator.id}" />
	            <h:outputText value="required fields" rendered="#{identity.loggedIn and currentUser.id eq linkHome.instance.creator.id}" />            	
            </div>

        </rich:panel>

        <div class="actionButtons">
        	<h:commandButton id="save"
                          value="Save"
                         action="#{linkHome.persist}"
                       rendered="#{!linkHome.managed}"/>
            <h:commandButton id="update"
                          value="Save"
                         action="#{linkHome.update}"
                       rendered="#{linkHome.managed and identity.loggedIn and currentUser.id eq linkHome.instance.creator.id}"/>
            <h:commandButton id="delete"
                      value="Delete"
                      action="#{linkHome.remove}"                      
                      immediate="true"
                      rendered="#{linkHome.managed and identity.loggedIn and currentUser.id eq linkHome.instance.creator.id}">                      
            </h:commandButton>            	
            <s:button id="cancel"
                      value="Back" 
                      propagation="end"                                                
                      view="#{linkList.from}" />            
        </div>

    </h:form>

</ui:define>

</ui:composition>
